<section class="p-6 bg-[#CBF3F0] min-h-screen">
  <!-- Encabezado -->
  <div class="flex items-center justify-between mb-4 px-2">
    <a [routerLink]="['/home']">
      <img src="assets/img/Logo.png" alt="Logo Clínica" class="h-16 w-auto cursor-pointer" />
    </a>
    <h1 class="text-xl font-bold text-white bg-[#2EC4B6] px-3 py-1 rounded">
      Horario: Dr. Pérez
    </h1>
    <div class="space-x-2">
      <button
        *ngIf="!editing"
        (click)="startEdit()"
        class="bg-[#FFBF69] text-black font-bold px-3 py-1 rounded hover:bg-[#ff9f1c] transition"
      >
        Editar Horario
      </button>
      <button
        *ngIf="editing"
        (click)="saveSchedule()"
        class="bg-green-500 text-white font-bold px-3 py-1 rounded hover:bg-green-600 transition"
      >
        Guardar
      </button>
      <button
        *ngIf="editing"
        (click)="cancelEdit()"
        class="bg-red-500 text-white font-bold px-3 py-1 rounded hover:bg-red-600 transition"
      >
        Cancelar
      </button>
    </div>
  </div>

  <!-- Tabla de disponibilidad -->
  <div class="overflow-auto rounded-lg shadow-lg bg-white p-3 mx-2">
    <table class="table-fixed w-full border-collapse border-2 border-black text-sm">
      <thead>
        <tr>
          <th class="w-20 border-2 border-black bg-[#FFBF69]"></th>
          <th
            *ngFor="let d of days"
            class="border-2 border-black bg-[#2EC4B6] text-white font-bold text-center py-2"
          >
            {{ d }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let t of times; let i = index"
          class="h-12"
          [ngClass]="i % 2 === 0 ? 'bg-[#cbf3f0]' : 'bg-white'"
        >
          <td class="border-2 border-black bg-[#FFBF69] text-right pr-2 font-medium">
            {{ t }}
          </td>
          <td
            *ngFor="let d of days"
            class="border-2 border-black p-2 relative cursor-pointer"
            (click)="toggleSlot(d, t)"
          >
            <!-- Indicador circular de estado -->
            <div
              class="w-2.5 h-2.5 rounded-full absolute top-1 right-1 transition-colors"
              [ngClass]="{
                'bg-green-500': getStatus(d, t) === 'available',
                'bg-red-500': getStatus(d, t) === 'occupied',
                'bg-gray-500': getStatus(d, t) === 'blocked'
              }"
              [title]="
                getStatus(d, t) === 'available'
                  ? 'Disponible'
                  : getStatus(d, t) === 'occupied'
                  ? 'Ocupado por paciente'
                  : 'Bloqueado'
              "
            ></div>

            <!-- Nombre del paciente -->
            <div
              *ngIf="getStatus(d, t) === 'occupied' && getPatientName(d, t)"
              class="text-[10px] mt-1 text-gray-700 font-medium"
            >
              Paciente: {{ getPatientName(d, t) }}
            </div>

            <!-- Texto bloqueado -->
            <div
              *ngIf="getStatus(d, t) === 'blocked'"
              class="text-[10px] mt-1 text-gray-600 italic font-medium"
            >
              Bloqueado
            </div>

            <!-- X grande pero no total para bloqueado -->
            <svg
              *ngIf="getStatus(d, t) === 'blocked'"
              class="absolute inset-0 w-3/4 h-3/4 m-auto text-gray-600 opacity-50 pointer-events-none"
              fill="none"
              stroke="currentColor"
              stroke-width="4"
              viewBox="0 0 24 24"
              preserveAspectRatio="xMidYMid meet"
            >
              <line x1="0" y1="0" x2="24" y2="24" />
              <line x1="24" y1="0" x2="0" y2="24" />
            </svg>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
